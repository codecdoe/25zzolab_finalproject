import streamlit as st
import requests

API_KEY = "2f7ff809309654c9d9105c45df3f2a65"

st.title("🏞 날씨 기반 옷차림 · 운동 · 건강 추천기")
address = st.text_input("한국 주소를 입력하세요 (예: 삼청동, 마곡동, 강남구):")

def get_recommendations(temp: float, weather: str):
    ranges = list(range(4, 29, 3))
    closest = max([r for r in ranges if temp >= r], default=4)
    key = "비" if "rain" in weather.lower() else "맑음"

    data = {
        4: {
            "옷차림": {
                "맑음": """
**두꺼운 코트**, **기모 바지**, **니트**, **장갑** 등 방한 기능이 뛰어난 옷을 입어야 합니다. 바람이 강하거나 체감온도가 더 낮을 경우를 대비해 **목도리**나 **방풍 외투**도 필요합니다. 내복을 함께 착용하거나 **기모 내의**, **히트텍** 등 발열 의류를 이너로 활용하면 체온 유지에 효과적입니다. 아침저녁으로 **0도 이하**로 떨어질 수 있기 때문에 특히 **손발 보온**에 유의하고, **양털 부츠나 방한화**도 추천됩니다.
"""
            },
            "운동": {}, "건강": {}
        },
        7: {
            "옷차림": {
                "맑음": """
기온이 약 7도 전후일 때는 아직 추운 겨울 날씨에 속하므로 **울 코트**, **니트**, **기모 청바지** 또는 두꺼운 **슬랙스**가 적절합니다. **머플러**, **비니**, **방한 장갑** 등을 활용하여 체온을 유지하는 것이 중요합니다. 특히 이 시기의 바람은 체감온도를 급격히 낮추므로 바람을 막는 **하이넥 아우터**가 효과적입니다. **내복이나 히트텍**을 이너로 입고, 활동성 있는 **앵클 부츠**를 매치하면 실용성과 보온성을 동시에 만족시킬 수 있습니다.
"""
            },
            "운동": {}, "건강": {}
        },
        10: {
            "옷차림": {
                "맑음": """
**얇은 니트**, **후드티**, **맨투맨** 위에 **가벼운 울 코트**나 **트렌치코트**를 걸치는 것이 적절합니다. 바람을 막기 위해 얇은 **머플러**를 추가해도 좋습니다. **기모 슬랙스**, **청바지** 등 다리 보온도 신경 써야 하며, **속기모 이너**를 활용하면 좋습니다. **가죽 운동화**나 **하이탑 스니커즈** 같이 발목을 덮는 신발이 보온 유지에 도움을 줍니다. 이 시기의 핵심은 **실내외 온도차에 유연하게 대응할 수 있는 겹쳐 입기**입니다.
"""
            },
            "운동": {}, "건강": {}
        },
        13: {
            "옷차림": {
                "맑음": """
**자켓**, **가디건**, **얇은 니트** 혹은 **긴팔 티셔츠** 조합이 잘 어울리는 시기입니다. **일교차**가 크기 때문에 아침저녁은 쌀쌀하고 한낮은 따뜻할 수 있으므로 겉옷은 필수입니다. 하의는 **코튼 팬츠**나 **얇은 데님**, 신발은 **운동화**나 **플랫 슈즈**가 적당합니다. 바람이 부는 날에는 **얇은 바람막이**나 **경량 패딩 조끼**로 보온을 더해도 좋습니다. 실내에서는 겉옷을 벗고 활동할 수 있도록 조절 가능한 복장을 선택하세요.
"""
            },
            "운동": {}, "건강": {}
        },
        16: {
            "옷차림": {
                "맑음": """
**맨투맨**, **얇은 니트**, **셔츠형 아우터**, **바람막이 자켓** 등이 적당합니다. 이 기온대는 활동량에 따라 체감온도가 달라질 수 있으므로 **레이어드 스타일**이 유리합니다. 하의는 **면바지**, **데님 팬츠**, **슬랙스**가 적절하며, 신발은 **스니커즈**나 **편한 워킹화**가 좋습니다. 가볍지만 보온성 있는 **얇은 카디건**을 가방에 챙기는 것도 좋은 대비입니다. 실외 활동이 많다면 **모자**나 **선글라스**로 햇살을 차단할 수 있습니다.
"""
            },
            "운동": {}, "건강": {}
        },
        19: {
            "옷차림": {
                "맑음": """
**긴팔 셔츠**, **얇은 맨투맨**, 또는 **얇은 자켓** 정도면 충분합니다. 하의는 **슬랙스**, **면바지**, 또는 **얇은 청바지**가 적당하고, 낮 동안 활동량이 많다면 **반팔 위에 셔츠를 걸치는 레이어드**도 유용합니다. 이 시기에는 옷이 너무 두껍지 않게, 대신 **겹쳐 입기 전략**으로 실내외 온도차에 대처할 수 있어야 합니다. 신발은 **로퍼**, **운동화**, **단화** 등이 적당합니다. 외출 시엔 **가볍게 들 수 있는 얇은 겉옷** 하나를 챙기는 것이 좋습니다.
"""
            },
            "운동": {}, "건강": {}
        },
        22: {
            "옷차림": {
                "맑음": """
**반팔 티셔츠**, **얇은 셔츠**, **면바지**, **슬랙스**, 또는 **얇은 원피스** 등 가벼운 옷차림이 적절합니다. 햇볕이 강한 날은 **자외선 차단제**, **모자**, **선글라스**를 함께 활용하면 좋습니다. 아침저녁으로 서늘함이 남아 있다면 **얇은 가디건**이나 **셔츠형 겉옷**을 챙기면 유용합니다. 신발은 **샌들**, **운동화**, 또는 통풍이 잘 되는 **로퍼**가 적합합니다. 이 시기의 핵심은 **더위를 피하면서도 스타일을 살리는 가볍고 통기성 있는 옷**입니다.
"""
            },
            "운동": {}, "건강": {}
        },
        25: {
            "옷차림": {
                "맑음": """
**민소매**, **반팔 티셔츠**, **반바지**, **얇은 린넨 셔츠**, **통기성 좋은 치마** 등 여름철 복장이 적합합니다. 햇볕이 매우 강하므로 **자외선 차단제**, **선글라스**, **모자**는 필수입니다. 신발은 **슬리퍼**, **샌들**, 또는 가벼운 **운동화**도 좋으며, 외출 시에는 **물병**을 꼭 휴대하여 탈수 예방에 유의하세요. 실내는 에어컨으로 인해 냉방이 강할 수 있으므로 **얇은 긴팔 가디건**을 챙기는 것도 유익합니다.
"""
            },
            "운동": {}, "건강": {}
        },
        28: {
            "옷차림": {
                "맑음": """
**나시**, **민소매 원피스**, **반팔**, **얇은 린넨 바지**, **반바지** 등 최대한 시원하고 통기성 있는 옷을 입는 것이 중요합니다. **햇빛이 매우 강하고 자외선 지수가 높기 때문에 자외선 차단제를 꼭 사용하고, 모자나 선글라스를 함께 착용**해야 합니다. 신발은 **샌들**, **슬리퍼** 등이 적합하고, 활동량이 많은 날에는 **통기성 좋은 운동화**도 괜찮습니다. 외출 시에는 **물병**을 챙기고, 활동은 한낮을 피해서 오전 또는 저녁으로 미루는 것이 좋습니다.
"""
            },
            "운동": {}, "건강": {}
        }
    }

    selected = data[closest]
    return {
        "옷차림": selected["옷차림"].get(key, ""),
        "운동": selected["운동"].get(key, ""),
        "건강": selected["건강"].get(key, "")
    }

def get_coordinates(address):
    geo_url = f"http://api.openweathermap.org/geo/1.0/direct?q={address},KR&limit=1&appid={API_KEY}"
    res = requests.get(geo_url).json()
    if not res:
        return None, None
    return res[0]["lat"], res[0]["lon"]

def get_weather(lat, lon):
    url = f"https://api.openweathermap.org/data/2.5/weather?lat={lat}&lon={lon}&appid={API_KEY}&units=metric"
    res = requests.get(url).json()
    temp = res["main"]["temp"]
    weather = res["weather"][0]["description"]
    return temp, weather

if address:
    lat, lon = get_coordinates(address)
    if lat is None:
        st.error("❌ 주소를 찾을 수 없습니다. 도로명 주소를 다시 확인해주세요.")
    else:
        temp, weather = get_weather(lat, lon)
        st.success(f"""📍 위치: **{address}**  
🌡 현재 기온: **{temp:.1f}°C**  
🌥 날씨 상태: **{weather}**""")

        recommendation = get_recommendations(temp, weather)

        st.markdown("### 👕 옷차림 추천")
        st.markdown(recommendation["옷차림"])

        st.markdown("### 🏃 운동 추천")
        st.markdown(recommendation["운동"])

        st.markdown("### 💡 건강 조언")
        st.markdown(recommendation["건강"])

        st.image(
            "https://wimg.kyeongin.com/news/legacy/file/201810/20181010000733388_1.jpg",
            caption="기온에 따라 달라지는 계절별 옷차림 예시",
            use_column_width=True
        )

'''
import streamlit as st
import requests

# API 키 설정
API_KEY = "2f7ff809309654c9d9105c45df3f2a65"

# UI 구성
st.title("🏞 날씨 기반 옷차림 · 운동 · 건강 추천기")
address = st.text_input("한국 주소를 입력하세요 (예: 삼청동, 마곡동, 강남구):")


# 추천 정보를 반환하는 함수
def get_recommendations(temp: float, weather: str):
    ranges = list(range(4, 29, 3))
    closest = max([r for r in ranges if temp >= r], default=4)
    key = "비" if "rain" in weather.lower() else "맑음"

    data = {
        4: {
            "옷차림": {
                "맑음": "4도는 매우 쌀쌀한 날씨로, 두꺼운 겨울 코트, 니트, 기모 바지, 장갑이 필수입니다. 체온 유지를 위해 모자나 목도리도 착용해주는 것이 좋습니다.",
                "비": "비가 오는 추운 날은 방수 외투, 방한 장갑, 방수 부츠, 따뜻한 이너웨어가 필요합니다."
            },
            "운동": {
                "맑음": "걷기나 가벼운 등산 추천. 보온성을 높인 복장을 착용하세요.",
                "비": "실내 자전거, 실내 요가 등 실내 운동이 좋습니다."
            },
            "건강": {
                "맑음": "호흡기 질환 예방을 위해 마스크 착용과 수분 섭취를 잊지 마세요.",
                "비": "감기 예방을 위해 젖은 옷은 바로 갈아입고, 난방기 사용 시 건조함에 주의하세요."
            }
        },
        10: {
            "옷차림": {
                "맑음": "10도 전후의 날씨에는 후드티나 얇은 코트, 니트가 적당하며, 활동성이 좋으면서도 따뜻함을 유지할 수 있는 복장을 추천합니다.",
                "비": "가벼운 방수 재킷과 긴 바지를 추천하며, 외출 시 방수 신발이 필요합니다."
            },
            "운동": {
                "맑음": "야외 조깅이나 하이킹이 적절합니다. 햇볕이 있다면 체온 유지에 용이합니다.",
                "비": "홈트레이닝, 필라테스 등 무리 없는 실내 운동 추천."
            },
            "건강": {
                "맑음": "건조해지는 계절에는 수분 섭취와 보습이 중요합니다.",
                "비": "젖은 환경에서 면역력이 떨어질 수 있으니 외출 후엔 따뜻한 물로 샤워하세요."
            }
        },
        16: {
            "옷차림": {
                "맑음": "맨투맨이나 얇은 니트, 청바지 등 간절기에 적합한 복장이 좋습니다. 가벼운 자켓은 아침저녁에 유용합니다.",
                "비": "바람막이와 긴팔 셔츠, 방수 신발이 효과적입니다."
            },
            "운동": {
                "맑음": "자전거 타기, 야외 스트레칭 등 적절한 야외 운동 추천.",
                "비": "헬스장 근력 운동, 요가 등 실내 중심 운동이 적절합니다."
            },
            "건강": {
                "맑음": "환절기 알레르기 예방을 위해 외출 후 손씻기와 세안 철저히!",
                "비": "습한 날씨엔 곰팡이 주의, 제습기 사용도 고려해보세요."
            }
        },
        22: {
            "옷차림": {
                "맑음": "반팔 티셔츠, 면바지, 원피스 등 가벼운 옷이 적합하며, 햇볕이 강한 경우 모자나 선크림도 추천합니다.",
                "비": "얇은 우비와 통풍 좋은 신발, 반팔 티셔츠 조합이 적절합니다."
            },
            "운동": {
                "맑음": "야외 걷기, 한강 자전거, 공원 운동 추천.",
                "비": "에어로빅, 실내 스피닝 등 실내 유산소 운동 추천."
            },
            "건강": {
                "맑음": "자외선 지수에 따라 선크림 사용, 냉방기 사용 시 건조 주의.",
                "비": "습한 실내 환경 환기 필수, 음식물 부패 주의하세요."
            }
        },
        28: {
            "옷차림": {
                "맑음": "나시, 반바지, 린넨 소재 옷 등이 적당하며, 자외선 차단제를 꼭 바르고 충분한 수분을 섭취하세요.",
                "비": "얇은 반팔에 레인코트를 착용하고, 젖어도 괜찮은 샌들을 신는 것이 좋습니다."
            },
            "운동": {
                "맑음": "이른 아침 또는 해질 무렵에 가벼운 산책이나 스트레칭 권장.",
                "비": "덥고 습할 땐 수영, 실내 걷기 등이 무리 없는 선택입니다."
            },
            "건강": {
                "맑음": "열사병 예방을 위해 자주 쉬고, 물을 자주 마시세요.",
                "비": "에어컨 환경에서 장시간 있을 경우 체온 유지에 주의하세요."
            }
        }
    }

    selected = data[closest]
    return {
        "옷차림": selected["옷차림"][key],
        "운동": selected["운동"][key],
        "건강": selected["건강"][key]
    }

# 위도, 경도 변환
def get_coordinates(address):
    geo_url = f"http://api.openweathermap.org/geo/1.0/direct?q={address},KR&limit=1&appid={API_KEY}"
    res = requests.get(geo_url).json()
    if not res:
        return None, None
    return res[0]["lat"], res[0]["lon"]

# 현재 날씨 정보
def get_weather(lat, lon):
    url = f"https://api.openweathermap.org/data/2.5/weather?lat={lat}&lon={lon}&appid={API_KEY}&units=metric"
    res = requests.get(url).json()
    temp = res["main"]["temp"]
    weather = res["weather"][0]["description"]
    return temp, weather

# 실행
# 실행
if address:
    lat, lon = get_coordinates(address)
    if lat is None:
        st.error("❌ 주소를 찾을 수 없습니다. 도로명 주소를 다시 확인해주세요.")
    else:
        temp, weather = get_weather(lat, lon)
        st.success(f"""📍 위치: **{address}**  
🌡 현재 기온: **{temp:.1f}°C**  
🌥 날씨 상태: **{weather}**""")

        recommendation = get_recommendations(temp, weather)

        st.markdown("### 👕 옷차림 추천")
        st.markdown(recommendation["옷차림"])

        st.markdown("### 🏃 운동 추천")
        st.markdown(recommendation["운동"])

        st.markdown("### 💡 건강 조언")
        st.markdown(recommendation["건강"])

        # ✅ 마지막에 이미지 출력
        st.image(
            "https://wimg.kyeongin.com/news/legacy/file/201810/20181010000733388_1.jpg",
            caption="기온에 따라 달라지는 계절별 옷차림 예시",
            use_column_width=True
        )
'''
